前言
该篇文章为笔者多年使用MySql的经验之谈，其中一部分也来自网上收集，不作为标准但具有参考价值，现统一整理成该文章。

在java应用开发中深知数据库的重要性，绝大多数情况下数据库的性能决定了程序的性能，前期如果埋下的坑越多到后期会成为整个程序的瓶颈，所以希望java开发者一定要重视

一、基础规范
1、使用InnoDB存储引擎

支持事务、行级锁、并发性能更好、CPU及内存缓存页优化使得资源利用率更高

2、推荐使用utf8mb4字符集

无需转码，无乱码风险, 支持emoji表情以及部分不常见汉字

3、表、字段必须加注释

除了建表的人，谁还会知道这个字段是什么意思。

4、不在数据库做计算

禁止使用存储过程、视图、触发器、Event

并发量大的情况下，这些功能很可能将数据库拖跨，业务逻辑放到服务层具备更好的扩展性，能够轻易实现“增机器就加性能”

5、禁止存储文件

文件存储在文件系统，数据库里存URI

6、控制单表数据量

单表记录控制在千万级

二、命名规范
1、库名、表名、字段名：小写，下划线风格，

非唯一索引名idx_xxx，唯一索引名uniq_xxx

2、表必须有主键，例如自增主键

a）主键递增，数据行写入可以提高插入性能

b）主键要选择较短的数据类型，Innodb引擎普通索引都会保存主键的值，较短的数据类型可以有效的减少索引的磁盘空间，提高索引的缓存效率

c）保证实体的完整性，唯一性

3、不要使用外键，如果有外键约束，用应用程序控制

外键会导致表与表之间耦合，update与delete操作都会涉及相关联的表，十分影响sql 的性能，甚至会造成死锁。高并发情况下容易造成数据库性能，大数据高并发业务场景数据库使用以性能优先

三、字段设计规范

1、把字段定义为NOT NULL并且提供默认值

a）null的列使索引/索引统计/值比较都更加复杂，对MySQL来说更难优化

b）null 这种类型MySQL内部需要进行特殊处理，增加数据库处理记录的复杂性；同等条件下，表中有较多空字段的时候，数据库的处理性能会降低很多

c）null值需要更多的存储空间，无论是表还是索引中每行中的null的列都需要额外的空间来标识

d）对null 的处理时候，只能采用is null或is not null，而不能采用=、in、<、<>、!=、not in这些操作符号。如：where name!=’zhangsan’，如果存在name为null值的记录，查询结果就不会包含name为null值的记录

2、不要使用TEXT、BLOB类型

会浪费更多的磁盘和内存空间，非必要的大量的大字段查询会淘汰掉热数据，导致内存命中率急剧降低，影响数据库性能,如果必须要使用则独立出来一张表，用主键来对应，避免影响其它字段索引效率

3、不要使用小数存储货币

建议使用整数，小数容易导致钱对不上

4、必须使用varchar存储手机号

手机号会去做数学运算么？

5、为提高效率可以牺牲范式设计，冗余数据

a)不是频繁修改的字段

b)不是 varchar 超长字段，更不能是 text 字段

四、索引设计规范

1、禁止在更新十分频繁、区分度不高的属性上建立索引

a）更新会变更B+树，更新频繁的字段建立索引会大大降低数据库性能

b）“性别”这种区分度不大的属性，建立索引是没有什么意义的

2、建立组合索引，必须把区分度高的字段放在最左边

如果 where a=? and b=? ， a 列的几乎接近于唯一值，那么只需要单建 idx_a 索引即可

3、 页面搜索严禁左模糊或者全模糊

索引文件具有 B-Tree 的最左前缀匹配特性，如果左边的值未确定，那么无法使用此索引, 如果需要请走搜索引擎来解决

五、SQL使用规范

1、禁止使用SELECT ，只获取必要的字段，需要显示说明列属性

a）消耗cpu，io，内存，带宽

b）不能有效的利用覆盖索引

c）使用SELECT 容易在增加或者删除字段后出现程序BUG, 不具有扩展性

2、使用INSERT INTO t_xxx VALUES(xxx)，必须显示指定插入的列属性

容易在增加或者删除字段后出现程序BUG

3、务必请使用“同类型”进行比较，否则可能全表扫面

SELECT name FROM t_user WHERE phone=1333333333 会导致全表扫描.

4、禁止在WHERE条件的上使用函数或者计算

解读：SELECT naem FROM t_user WHERE date(create_datatime)='2017-12-15' 会导致全表扫描

推荐的写法是：SELECT name FROM t_user WHERE create_datatime>= '2017-02-15 ' and create_datatime < '2017-02-16 '

5、禁止负向查询，以及%开头的模糊查询

a）负向查询条件：NOT、!=、<>、!<、!>、NOT IN、NOT LIKE等，会导致全表扫描

b）%开头的模糊查询，会导致全表扫描

6、不要大表使用JOIN查询，禁止大表使用子查询

会产生临时表，消耗较多内存与CPU，极大影响数据库性能

7、OR改写为IN()或者UNION

原因很简单or不会走索引

8、简单的事务

事务就像程序中的锁一样粒度尽可能要小

9、不要一次更新大量数据

数据更新会对行或者表加锁，应该分为多次更新
